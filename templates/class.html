{% extends "base.html" %}
{% block title %}{{ classname }}{% endblock %}

{% block body %}
<div class="page-content">
  <div class="mb-10 mt-20"><b>{{ classname }}</b></div>
  <div class="mb-10">{{ description }}</div>
  {% if session["is_admin"] %}
    <form class="inline" method="POST" action="/class/remove">
      <input type="hidden" name="classname" value="{{ classname }}">
      <input class="cancel button" type="submit" value="Poista kurssi">
    </form>
  {% elif not is_registered %}
    <form action="/class/signup" method="POST">
      <input type="hidden" name="class" value="{{ classname }}">
      <!-- Hide button if already registered -->
        <input type="submit" value="Ilmoittaudu" class="button">
      <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
    </form>
  {% else %}
    <span class="green-text">Olet ilmoittautunut kurssille.</span>
    <form action="/class/cancel" method="post">
      <input type="hidden" name="class" value="{{ classname }}">
      <input class="cancel button" type="submit" value="Peru ilmoittautuminen">
      <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
    </form>
  {% endif %}

  {% if not session["is_admin"] %}
    <div class="mt-20">Jätä kommentti:</div>
    <form method="POST" action="/class/comment">
      <input type="hidden" name="class" value="{{ classname }}">
      <textarea required name="comment" rows="9" cols="70"></textarea><br>
      <input class="button mt-14" type="submit" value="Lähetä">
      <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
    </form>
  {% endif %}

  <div class="mt-20">
    {% for row in comment_rows %}
      <div class="comment">
        <b>{{ row.username }}</b>
        {% if row.username == session["username"] or session["is_admin"] %}
          <form class="inline ml-12" method="post" action="/delete/comment">
            <input type="hidden" name="comment_id" value="{{ row.id }}">
            <input type="submit" class="delete" value="Poista kommentti">
            <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
          </form>
        {% endif %}
        <div>{{ row.comment }}</div>
      </div>
    {% endfor %}
  </div>

  {% if session["is_admin"] %}
    <div class="mt-4em underline">Kurssille ilmoittautuneet jäsenet</div>
    {% if not enrolled_members %}
      <div class="mt-20">Kukaan ei ole vielä ilmoittautunut tälle kurssille.</div>
    {% endif %}
    {% for member in enrolled_members %}
      <div class="member">{{ member.fname }} {{ member.lname }}
      <form class="inline ml-12" method="post" action="/remove/enrollment">
        <input type="hidden" name="username" value="{{ member.username }}">
        <input type="hidden" name="classname" value="{{ classname }}">
        <input type="submit" class="delete" value="Poista kurssilta">
        <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
      </form>
      </div>
    {% endfor %}
  {% endif %}
</div>
{% endblock %}
